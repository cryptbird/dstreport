<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Patient Data</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin-top: 0;
			padding: 180px;
		}

		.container {
			width: 100%;
			max-width: 7.5in;
			/* Ensure it fits within the PDF width (8.5in - margins) */
			/* margin: auto; */
			overflow: hidden;
			/* Prevent content overflow */
			word-wrap: break-word;
			/* Wrap long text */
		}

		.data-field {
			margin-bottom: 10px;
			font-size: 16px;
		}

		.label {
			font-weight: bold;
		}

		#printBtn {
			margin-top: 20px;
			padding: 10px 20px;
			background-color: #007bff;
			color: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		#printBtn:hover {
			background-color: #0056b3;
		}

		#chartContainer {
			margin-top: 40px;
			max-width: 7.5in;
			/* Match container width */
			overflow-x: auto;
			/* Allow scrolling for wide charts */
		}

		.pageheadline {
			border-bottom: 5px solid #ab29b9;
			padding-bottom: 15px;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
				Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
				sans-serif;
			font-weight: 600;
			font-size: small;
		}

		.reportheading {
			font-size: 30px;
			font-family: "Times New Roman", Times, serif;
			font-weight: 900;
			margin-top: 50px;
			margin-left: 25px;
			margin-right: 25px;
		}

		.reportcontent {
			margin: 25px;
			font-size: 15px;
			color: #727a98;
			font-family: "Times New Roman", Times, serif;
			font-weight: 600;
			line-height: 25px;
		}
		.scorecontent {
			margin: 25px;
			font-size: 12px;
			color: #727a98;
			font-family: "Times New Roman", Times, serif;
			font-weight: 600;
			line-height: 15px;
		}	
		
	</style>
</head>

<body>
	<div id="contentToPrint" style="margin: 0; padding: 0">
		<div class="pageheadline" style="border-bottom: 0;"> .</div>
		<div class="pageheadline">Detailed Feature Report</div>
		<div class="reportheading">
			<span style="color: #9b00ab">Developmental </span>Screening:
		</div>
		<div class="reportcontent">
			The Aignosis developmental screening test is a cutting-edge tool
			designed to identify early signs of autism and other developmental
			delays in children aged 2 to 8 years. The test evaluates developmental
			patterns through advanced A1 algorithms trained to detect subtle markers
			of developmental differences.
			<br /><br />
			The system provides outputs as <span id="classificationmessage" style="font-size: 15px; color: #007bff;"></span>
			<br /><br />
		</div>
		<span style="
          color: #9b00ab;
          font-family: 'Times New Roman', Times, serif;
          font-size: 15px;
          font-weight: 600;
		  margin-left: 25px;
        ">
			Detailed Psychology Report
		</span>
		<br />
		<span style="
          font-family: 'Times New Roman', Times, serif;
          font-size: 15px;
          font-weight: 600;
		  margin-left: 25px;
        ">
			Summary of Domain Specific Challenges
		</span>
		<br /><br />
		<span style="font-family: 'Times New Roman', Times, serif; margin-left: 25px;">
			Lower scores indicate high Challenges
		</span>
		<center>
		<div class="container" id="contentToPrint">
			<!-- <h1>Patient Information</h1> -->
			<div id="patientData" hidden>
				<!-- Data will be displayed here -->
			</div>

			<div id="chartContainer">
				<!-- <h2>Percentage Chart</h2> -->
				<canvas id="barChart"></canvas>
			</div>
		</div>
		</center>
	
	
	<div class="scorecontent">
		The Aignosis developmental test output was: <p id='message' style="font-size: xx-large; color: #007bff;"></p> 
		0% developmental score - maximally neurotypical score. A score of 100% developmental challenge is achieved ifthe most neurotypical response is selected for each relevant question in
		this domain. <br>
		100%, developmental score = maximally atypical score. A score of 100%. developmental challenge is achieved if the most atypical response is selected for each relevant question in this
		domain. <br>
	</div>	
</div>
<center>
	<button id="printBtn">Print PDF</button>
</center>
<script>
		

	// Function to get URL parameters
	function getURLParameter(name) {
		const urlParams = new URLSearchParams(window.location.search);
		return urlParams.get(name);
	}

	// Function to display the data
	function displayData() {
		const patientData = {
			patientId: getURLParameter("patient_id"),
			socialResponsiveness:
				parseFloat(getURLParameter("social_response")) || 0,
			emotionalResponsiveness:
				parseFloat(getURLParameter("emotional_response")) || 0,
			speechRecognition:
				parseFloat(getURLParameter("speech_recognition")) || 0,
			behaviouralPattern:
				parseFloat(getURLParameter("behaviour_pattern")) || 0,
			sensoryAspects: parseFloat(getURLParameter("sensory_aspect")) || 0,
			cognitiveComponent: parseFloat(getURLParameter("cognitive")) || 0,
			testscore:parseFloat(getURLParameter("testscore")) || 0,
			classification:parseFloat(getURLParameter("classification")) || 0,
		};

		const patientDataContainer = document.getElementById("patientData");
		for (const [key, value] of Object.entries(patientData)) {
			const fieldDiv = document.createElement("div");
			fieldDiv.classList.add("data-field");
			fieldDiv.innerHTML = `<span class="label">${key
				.replace(/([A-Z])/g, " $1")
				.toUpperCase()}:</span> ${value || "N/A"}`;
			patientDataContainer.appendChild(fieldDiv);
		}

		// Generate bar chart
		createBarChart(patientData);
		document.getElementById('message').innerHTML = patientData.testscore;
		document.getElementById('classificationmessage').innerHTML = patientData.classification;
	}
	
	// Function to create a horizontal bar chart
	function createBarChart(data) {
		const labels = [
			"Social Responsiveness",
			"Emotional Responsiveness",
			"Speech Recognition",
			"Behavioural Pattern",
			"Sensory Aspects",
			"Cognitive Component",
		];

		const values = [
			data.socialResponsiveness,
			data.emotionalResponsiveness,
			data.speechRecognition,
			data.behaviouralPattern,
			data.sensoryAspects,
			data.cognitiveComponent,
		];

		const ctx = document.getElementById("barChart").getContext("2d");
		new Chart(ctx, {
			type: "bar",
			data: {
				labels: labels,
				datasets: [
					{
						label: "Percentage",
						data: values,
						backgroundColor: [
							"rgba(75, 192, 192, 0.2)",
							"rgba(54, 162, 235, 0.2)",
							"rgba(255, 206, 86, 0.2)",
							"rgba(153, 102, 255, 0.2)",
							"rgba(255, 159, 64, 0.2)",
							"rgba(201, 203, 207, 0.2)",
						],
						borderColor: [
							"rgba(75, 192, 192, 1)",
							"rgba(54, 162, 235, 1)",
							"rgba(255, 206, 86, 1)",
							"rgba(153, 102, 255, 1)",
							"rgba(255, 159, 64, 1)",
							"rgba(201, 203, 207, 1)",
						],
						borderWidth: 1,
					},
				],
			},
			options: {
				indexAxis: "y", // This reverses the axes
				scales: {
					x: {
						beginAtZero: true,
						max: 100,
					},
				},
			},
		});
	}

	// Call the function to display data once the page loads
	window.onload = displayData;

	// Add functionality to the Print PDF button
	document
		.getElementById("printBtn")
		.addEventListener("click", function () {
			const element = document.getElementById("contentToPrint");
			const options = {
				margin: [0, 0.5, 0, 0], // No margins
				filename: "patient_data.pdf",
				image: { type: "jpeg", quality: 0.98 },
				html2canvas: {
					scale: 2, // Higher scale for better quality
					width: element.offsetWidth, // Use container width
				},
				jsPDF: { unit: "in", format: "letter", orientation: "portrait" },
			};
			html2pdf()
				.set({
					html2canvas: { scrollX: 0, scrollY: 0 },
				})
				.from(element)
				.save();
		});
</script>
</body>

</html>